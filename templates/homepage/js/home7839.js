function centerModal(){$(this).css('display','block');var $dialog=$(this).find(".registration-lightbox");var offset=($(window).height()-$dialog.height())/2;$dialog.css("margin-top",Math.max(0,offset));}
var
registerNs={init:function(options){var options=options||{};if(options.hasOwnProperty('elements')){this.setElements(options.elements);}
if(typeof jstz=='object'){var _jsTimezone=jstz.determine();this.submit.data.params.timezone=(_jsTimezone?_jsTimezone.name():'');}},apiErrors:{0:{"field":"general-error","message":"Please complete all the mandatory fields"},1:{"field":"general-error","message":"Please complete all the mandatory fields"},103:{"field":"username","message":"There was an error while registering. Please try again."},104:{"field":"r-nickname","message":"Nickname already used"},106:{"field":"general-error","message":"Please complete all the mandatory fields"},121:null},elements:{email:null,password:null,nickname:null,accessCode:null,terms:null,errors:null,submit:null,createCouplesRoom:null},setElements:function(elems){for(var i in elems){if(this.elements.hasOwnProperty(i)){this.elements[i]=elems[i];}}
return this;},validate:function(){var
emailVal=$.trim(this.elements.email.val()),emailRegExp=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,passwordVal=$.trim(this.elements.password.val()),nicknameVal=$.trim(this.elements.nickname.val()),accessCodeVal=$.trim(this.elements.accessCode.val()),errors={};if(!emailRegExp.test(emailVal)){errors['username']='Please enter a valid email address';}
if(passwordVal.length<8){errors['r-password']='Password must be 8 characters or more';}
if(nicknameVal.length==0){errors['r-nickname']='Please enter a nickname';}
if(accessCodeVal.length==0&&registerNs.elements.accessCode.length==1){errors['r-accessCode']='Please enter a valid access code';}
if(!this.elements.terms.is(':checked')){errors['r-terms']='Please agree to the terms of use and privacy policy';$(".authFormRow input[type='checkbox'] + label").css("background","url(/homepage/images/auth_mark_wrong.png) left center / 21px no-repeat");}
return errors;},clearBubble:function(){this.clearErrors();this.elements.email.val('').blur();this.elements.password.val('').blur();this.elements.nickname.val('').blur();this.elements.accessCode.val('').blur();this.elements.terms.attr('checked',false).blur();$(".authFormRow input[type='checkbox'] + label").css('background',"url(/homepage/images/auth_mark_default.png) left center / 21px no-repeat");},clearErrors:function(){if($(".input-error.username").text().trim().length>0){$(".placeholder.username").removeClass("hidden");$(".placeholder.username").addClass("up");}
if($(".input-error.r-password").text().trim().length>0){$(".placeholder.r-password").removeClass("hidden");$(".placeholder.r-password").addClass("up");}
if($(".input-error.r-nickname").text().trim().length>0){$(".placeholder.r-nickname").removeClass("hidden");$(".placeholder.r-nickname").addClass("up");}
this.elements.errors.html('').end().hide();this.elements.email.css('border-color','#C4C4C4').blur();this.elements.password.css('border-color','#C4C4C4').blur();this.elements.nickname.css('border-color','#C4C4C4').blur();this.elements.accessCode.css('border-color','#C4C4C4').blur();return this;},displayErrors:function(errors){var errorsLength=Object.keys(errors).length;if(errorsLength>0){for(var error in errors){$('.input-error.'+error).html(errors[error]);if($('.placeholder.'+error).hasClass('up')){$('.placeholder.'+error).addClass('hidden');}
$('#'+error).css('border-color','#FF0075');}}
return this;},submit:{url:function(){var
pathArray=window.location.href.split('/'),protocol=pathArray[0],host=pathArray[2];return protocol+'//'+host+'/rest/ios';},data:{method:'registerNewUser',params:{deviceType:'pc',redirectToPrivate:1,email:'',password:'',message:'',nickname:'',properAge:1,userAgreement:1,timezone:'',apiVersion:123,registrationUrl:window.location.href,options:{}}},event:function(){var
submitBtn=registerNs.elements.submit,alreadyClicked=submitBtn.data('clicked');if(alreadyClicked){return false;}
submitBtn.data('clicked',true);registerNs.clearErrors();var submitErrors=registerNs.validate();if(Object.keys(submitErrors).length>0){registerNs.displayErrors(submitErrors);submitBtn.data('clicked',false);return false;}
var
dataToPost=$.extend(this.data,{}),registrationReferrer=homepageNs.getReferrer();dataToPost.params.email=$.trim(registerNs.elements.email.val());dataToPost.params.password=registerNs.elements.password.val();dataToPost.params.nickname=$.trim(registerNs.elements.nickname.val());dataToPost.params.options.createCouplesRoom=registerNs.elements.createCouplesRoom===true?'1':'0'
dataToPost.params.options.optimizelyEndUserId=homepageNs.readCookie('optimizelyEndUserId');dataToPost.params.options.optimizelySegments=homepageNs.readCookie('optimizelySegments');dataToPost.params.options.optimizelyBuckets=homepageNs.readCookie('optimizelyBuckets');dataToPost.params.options.hasFlash=+homepageNs.clientHasFlash();if(typeof homepageNs.getQueryString().code!=="undefined"&&location.href.indexOf("/join?")!=-1){dataToPost.params.options.invitation_key=homepageNs.getQueryString().code;}
if(registrationReferrer){dataToPost.params.options.referrerUrl=registrationReferrer;}
if(typeof homepageNs.getQueryString().refid!=="undefined"){dataToPost.params.options.refid=homepageNs.getQueryString().refid;}
if(registerNs.elements.accessCode.length==1){dataToPost.params.options.accessCode=registerNs.elements.accessCode.val();}
$('#rl-register-btn').hide();$('.ajaxloader.greenAjaxLoader').show();$.ajax({type:'POST',url:this.url(),data:JSON.stringify(dataToPost),dataType:'json',success:function(data){if(data["returnCode "]==1&&data["result "]&&data["result "].url){window.location.href=data["result "].url;}else{$('#rl-register-btn').show();$('.ajaxloader.greenAjaxLoader').hide();submitBtn.data('clicked',false);if(registerNs.apiErrors.hasOwnProperty(data["returnCode "])){var errors={};if(registerNs.apiErrors[data["returnCode "]]){errors[registerNs.apiErrors[data["returnCode "]]['field']]=registerNs.apiErrors[data["returnCode "]]['message'];}else if(data["result "]&&data["result "].error){errors['general-error']=data["result "].error;}else{errors['general-error']='Something went wrong. Please try again later';}
registerNs.displayErrors(errors);}}},error:function(data){var errors={};errors['general-error']='Something went wrong. Please try again later';submitBtn.data('clicked',false);$('#rl-register-btn').show();$('.ajaxloader.greenAjaxLoader').hide();registerNs.displayErrors(errors);}});}}},homepageNs={referrerCookieName:'registrationReferrer',readCookie:function(name){var nameEQ=name+"=";var ca=document.cookie.split(';');for(var i=0,len=ca.length;i<len;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return decodeURIComponent(c.substring(nameEQ.length,c.length));}
return '';},createCookie:function(name,value,expires){var cookieExpires='';if(expires){var date=new Date();date.setTime(date.getTime()+(expires*1000));var expires="; expires="+date.toGMTString();}
document.cookie=name+"="+value+expires+"; path=/";return this;},saveReferrer:function(){var registrationReferrerCookie=this.readCookie(this.referrerCookieName);if(registrationReferrerCookie.length>0||document.referrer.length==0){return;}
this.createCookie(this.referrerCookieName,document.referrer,(1*24*60*60));return this;},getReferrer:function(){var
referrer=document.referrer,registrationReferrerCookie=this.readCookie(this.referrerCookieName);if(registrationReferrerCookie.length>0){referrer=registrationReferrerCookie;}
return referrer;},sendGoogleTag:function(ajaxResponse,options){if(typeof dataLayer!="undefined"&&ajaxResponse&&typeof ajaxResponse.gtm=="object"){options=options||{};var variables=$.extend({},ajaxResponse.gtm,options);variables['window_url']=window.location.href;dataLayer.push(variables);}else{if(options&&typeof options.eventCallback=="function"){options.eventCallback();}else if(ajaxResponse&&ajaxResponse.gtm&&typeof ajaxResponse.gtm.eventCallback=="function"){ajaxResponse.gtm.eventCallback();};}},getQueryString:function(){var
match,pl=/\+/g,search=/([^&=]+)=?([^&]*)/g,decode=function(s){return decodeURIComponent(s.replace(pl," "));},query=window.location.search.substring(1),urlParams={};while(match=search.exec(query)){urlParams[decode(match[1])]=decode(match[2]);}
return urlParams;},clientHasFlash:function(){var result=false;try{var fo=new ActiveXObject('ShockwaveFlash.ShockwaveFlash');if(fo)result=true;}catch(e){if(navigator.mimeTypes["application/x-shockwave-flash"]!=undefined)result=true;}
return result;},isIosDevice:function(){return /(iPad|iPhone|iPod)/g.test(navigator.userAgent);},updateLinksHref:function(){var urlQueryString=window.location.search;if(urlQueryString.length>0){$('a.inet').each(function(){if(typeof $(this).attr('href')!=='undefined'){var
link=$(this),newHref=homepageNs.updateHrefAndExcludeParams(link.attr('href'),homepageNs.getQueryString());link.attr('href',newHref);}});}
return this;},updateHrefAndExcludeParams:function(href,urlParams){var ignoreParams={'medix_access':['/medix/auth/login','/medix','/medix/']}
separator='?'
var newHref=href;if(href.indexOf('?')!=-1){href=href.slice(0,href.indexOf('?'))
separator='&';}
$.each(urlParams,function(key,value){if(typeof ignoreParams[key]!=="undefined"){if(ignoreParams[key]&&$.inArray($.trim(href),ignoreParams[key])>-1){newHref=newHref+separator+key+'='+value;separator='&';}}else{newHref=newHref+separator+key+'='+value;separator='&';}});return newHref;},setGaCustomSegments:function(){var
urlCustomParams=['Adc_A','Adc_B'],urlParams=this.getQueryString(),slot=1;if(typeof ga!='undefined'){for(var i=0,len=urlCustomParams.length;i<len;i++){var customParam=urlCustomParams[i];if(urlParams.hasOwnProperty(customParam)){ga('set','dimension'+slot,(urlParams[customParam].length>0?urlParams[customParam].length:'Yes'));slot++;hasSegments=true;}}}
return this;}};(function(){homepageNs.updateLinksHref().setGaCustomSegments().saveReferrer();$(".authFormRow input[type='checkbox'] + label").css('background',"url(/homepage/images/auth_mark_default.png) left center / 21px no-repeat");registerNs.init({elements:{email:$('#rl-bubble #username'),password:$('#rl-bubble #r-password'),nickname:$('#rl-bubble #r-nickname'),accessCode:$('#rl-bubble #r-accessCode'),terms:$('#rl-bubble #r-terms'),errors:$('#rl-bubble .input-error'),submit:$('#rl-register-btn')}});$("#r-terms").bind('change',function(){if($('#rl-bubble #r-terms').is(':checked')){$(".authFormRow input[type='checkbox'] + label").css('background','url(/homepage/images/auth_mark_check.png) left center / 21px no-repeat');}else{$(".authFormRow input[type='checkbox'] + label").css('background','url(/homepage/images/auth_mark_default.png) left center / 21px no-repeat');}});var initialData={'user_id':0,'user_type':'','nickname':'','registration_channel':0,'registration_source':'','registration_campaign':'','user_funnel_variation_for_new_rooms':'','referred_by_user_id':'','registration_browser_referrer':'','registration_full_url':'','room_id':0,'room_payment_type':0,'room_purchase_type':'','room_funnel_variation':'','room_plan_type':0,'room_status':0,'room_created_from':0,'event':'defaultPageLoad'};homepageNs.sendGoogleTag({"gtm":initialData});$('.modal').on('show.bs.modal',function(e){var dataTarget=$(e.relatedTarget).data('couple');if(typeof dataTarget!=='undefined'&&dataTarget===true){registerNs.elements.createCouplesRoom=true;}else{registerNs.elements.createCouplesRoom=false;}
var modal=$(this);var medixCode=homepageNs.getQueryString().medix_access;registerNs.clearBubble();if(registerNs.elements.accessCode.length==1&&typeof medixCode!=="undefined"){registerNs.elements.accessCode.val(medixCode);}
centerModal.apply(modal);if(typeof ga!='undefined'&&modal.attr('id')=='registration-lightbox'){ga('send','pageview','/virtual/homepage/ask/main_bubble');}});$(window).on("resize",function(){$('.modal:visible').each(centerModal);});$('#rl-register-btn').click(function(e){e.preventDefault();registerNs.submit.event();return false;});})();